<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pop The Balloons</title>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #000;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      #game-container {
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        background-image: linear-gradient(to top, #fff1eb 0%, #ace0f9 100%);
      }
    </style>
  </head>

  <body>
    <div id="game-container"></div>

    <script>
      const config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        parent: "game-container",
        scale: {
          mode: Phaser.Scale.RESIZE,
          autoCenter: Phaser.Scale.CENTER_BOTH,
        },
        transparent: true,
        scene: {
          preload,
          create,
          update,
        },
      };

      let score = 0;
      let timeLeft = 30;
      let scoreText;
      let timeText;
      let spawnEvent;
      let timerEvent;
      let gameActive = false;

      function preload() {}

      function create() {
        if (!gameActive) {
          showStartScreen(this);
        } else {
          startGame(this);
        }
      }

      function update() {}

      // ======================
      // START SCREEN
      // ======================

      function showStartScreen(scene) {
        const centerX = scene.scale.width / 2;
        const centerY = scene.scale.height / 2;

        scene.add
          .text(centerX, centerY - 80, "Pop The Balloons", {
            fontSize: "38px",
            fontStyle: "bold",
            stroke: "#1B1B1B",
            strokeThickness: 5,
            color: "#ffffff",
          })
          .setOrigin(0.5);

        const startBtn = scene.add
          .text(centerX, centerY, "Start Game", {
            fontSize: "24px",
            fontStyle: "bold",
            backgroundColor: "#ffffff",
            padding: { x: 24, y: 12 },
            color: "#000000",
          })
          .setOrigin(0.5)
          .setInteractive({ useHandCursor: true });

        const border = scene.add
          .rectangle(centerX, centerY, startBtn.width + 12, startBtn.height + 8)
          .setStrokeStyle(3, 0xffffff)
          .setOrigin(0.5);

        startBtn.setDepth(1);

        startBtn.on("pointerdown", () => {
          gameActive = true;
          scene.scene.restart();
        });
      }

      // ======================
      // START GAME
      // ======================

      function startGame(scene) {
        gameActive = true;
        score = 0;
        timeLeft = 30;

        scoreText = scene.add.text(20, 20, "Score: 0", {
          fontSize: "24px",
          fontStyle: "bold",
          stroke: "#1B1B1B",
          strokeThickness: 4,
          color: "#ffffff",
        });

        timeText = scene.add
          .text(scene.scale.width - 20, 20, "Time: 30", {
            fontSize: "24px",
            fontStyle: "bold",
            stroke: "#1B1B1B",
            strokeThickness: 4,
            color: "#ffffff",
          })
          .setOrigin(1, 0);

        spawnEvent = scene.time.addEvent({
          delay: 1000,
          callback: () => spawnBalloon(scene),
          loop: true,
        });

        timerEvent = scene.time.addEvent({
          delay: 1000,
          callback: () => {
            timeLeft--;
            timeText.setText("Time: " + timeLeft);

            if (timeLeft <= 0) {
              timerEvent.remove();
              spawnEvent.remove();
              gameActive = false;

              // 2-second delay before Game Over
              scene.time.delayedCall(2000, () => {
                endGame(scene);
              });
            }
          },
          loop: true,
        });
      }

      // ======================
      // SPAWN BALLOON
      // ======================

      function spawnBalloon(scene) {
        if (!gameActive) return;

        const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff];
        const x = Phaser.Math.Between(50, scene.scale.width - 50);
        const color = Phaser.Utils.Array.GetRandom(colors);

        const container = scene.add.container(x, scene.scale.height + 100);

        const balloon = scene.add.ellipse(0, 0, 60, 80, color);
        balloon.setInteractive({ useHandCursor: true });

        const string = scene.add.line(0, 40, 0, 40, 0, 110, 0x000000);
        string.setLineWidth(2);

        const knot = scene.add.triangle(0, 40, 0, 12, 12, 12, 6, 0, color);

        container.add([balloon, string, knot]);

        scene.tweens.add({
          targets: container,
          y: -200,
          duration: timeLeft > 20 ? 4000 : timeLeft > 10 ? 3000 : 2000,
          ease: "Linear",
          onComplete: () => container.destroy(),
        });

        balloon.on("pointerdown", () => {
          if (!gameActive) return;
          score++;
          scoreText.setText("Score: " + score);
          container.destroy();
        });
      }

      // ======================
      // END GAME
      // ======================

      function endGame(scene) {
        scene.add
          .text(
            scene.scale.width / 2,
            scene.scale.height / 2 - 60,
            "Game Over",
            {
              fontSize: "48px",
              fontStyle: "bold",
              stroke: "#1B1B1B",
              strokeThickness: 5,
              color: "#ffffff",
            },
          )
          .setOrigin(0.5);

        scene.add
          .text(
            scene.scale.width / 2,
            scene.scale.height / 2 - 10,
            "Final Score: " + score,
            {
              fontSize: "28px",
              fontStyle: "bold",
              stroke: "#1B1B1B",
              strokeThickness: 4,
              color: "#ffffff",
            },
          )
          .setOrigin(0.5);

        const restartBtn = scene.add
          .text(scene.scale.width / 2, scene.scale.height / 2 + 50, "Restart", {
            fontSize: "24px",
            fontStyle: "bold",
            backgroundColor: "#ffffff",
            padding: { x: 24, y: 12 },
            color: "#000000",
          })
          .setOrigin(0.5)
          .setInteractive({ useHandCursor: true });

        const border = scene.add
          .rectangle(
            scene.scale.width / 2,
            scene.scale.height / 2 + 50,
            restartBtn.width + 12,
            restartBtn.height + 8,
          )
          .setStrokeStyle(3, 0xffffff)
          .setOrigin(0.5);

        restartBtn.setDepth(1);

        restartBtn.on("pointerdown", () => {
          gameActive = true;
          scene.scene.restart();
        });
      }

      new Phaser.Game(config);
    </script>
  </body>
</html>
